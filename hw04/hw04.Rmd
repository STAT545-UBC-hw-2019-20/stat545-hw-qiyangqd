---
title: "Homework 04"
author: "Qi Yang"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```
```{r load, warning = FALSE, message = FALSE}
library(tidyverse)
library(tidyr)
library(gapminder)
library(DT)
guest <- read_csv("https://raw.githubusercontent.com/STAT545-UBC/Classroom/master/data/wedding/attend.csv")
email <- read_csv("https://raw.githubusercontent.com/STAT545-UBC/Classroom/master/data/wedding/emails.csv")
```

## Exercise 1: Univariate Data Reshaping - Option 1
### 1. Produce a tibble with one row per year, and columns for life expectancy for two or more countries.
```{r}
lifeExp_comp <- gapminder %>%  # Create new dataset: lifeExp_comp
  select(year, country, lifeExp) %>%  # Not necessary, only for comparison with the result of data re-lengthening below)
  filter(country == "Central African Republic" | country == "Japan") # Choose two countries we want to compare
lifeExp_comp_wider <- lifeExp_comp %>%  # Put data in wider format
                      pivot_wider(id_col = year,  # Pivot to create new columns for each country
                      names_from = country,
                      values_from = lifeExp) %>% 
                      rename(lifeExp_CAR = "Central African Republic", lifeExp_Japan = "Japan") 
                                                  # Rename to make the tibble clear
DT::datatable(lifeExp_comp_wider, rownames = FALSE)
```
This tibble provides life expectancies of **Central African Republic (CAR)** and **Japan** in different years. These two countries have the *lowest (53.008)* and *highest (84.55)* life expectany respectively in 2019. Although `gapminder` includes data from 1952 ~ 2007 only, it is still meaningful to compare them in the past in order to find inspiration for studying their current differences. According to the table above, the life expectancy of Japan was approximately *twice* as high as CAR.

### 2. Use the new data shape to scatterplot life expectancy for one country against that of another.
```{r}
lifeExp_comp_wider %>% 
  ggplot(aes(lifeExp_CAR, lifeExp_Japan)) + 
  geom_point()+
  labs(x = "Life expectancy of Central African Republic",
       y = "Life expectancy of Japan")+
  theme_classic() +
  coord_fixed() # Make axes on the same scale
```

The scatterplot shows the life expectancy of **Japan** vs. **CAR**. We can see huge differences between their life expectancies more clearly and directly.

### 3. Re-lengthen the data.

```{r}
lifeExp_comp_wider %>%  # Re-lengthen the wider data to the original one
   rename("Central African Republic" = "lifeExp_CAR", "Japan" = "lifeExp_Japan") %>% # Give back their original names
   pivot_longer(cols = c(-year),
               names_to = "country",
               values_to = "lifeExp") %>% 
   arrange(country) %>% # Arrange rows in the same order as before
   DT::datatable()
```

## Exercise 2: Multivariate Data Reshaping - Option 1
### 1. Make a tibble with one row per year, and columns for life expectancy and GDP per capita for two countries.

```{r}
lifeGDP <- gapminder %>%  # Create new dataset: lifeGDP
           select(year, country, lifeExp, gdpPercap) %>% 
           # Not necessary, only for comparing with the result of data re-lengthening below)
           filter(country == "Central African Republic" | country == "Japan") # Choose two countries we are interested in
lifeGDP_wider <- lifeGDP %>% # Put data in a wider format
                 pivot_wider(id_cols     = c(year), 
                 names_from  = c(country), 
                 names_sep   = "_", 
                 values_from = c(lifeExp, gdpPercap) ) %>% 
                 rename(lifeExp_CAR = "lifeExp_Central African Republic", gdpPercap_CAR = "gdpPercap_Central African Republic")                  # Rename to make the tibble nicer
DT::datatable(lifeGDP_wider)
```
This time I still chose **Central African Republic (CAR)** and **Japan** in order to compare their economic conditions. This tibble shows the life expectancy and GDP per capita of these two countries across years. We can see tremendous gaps between not only life expectancies but also GDP per capita: e.g. In 1997, Japan's GDP per capita was almost *40* times higher than CAR!

### 2. Re-lengthen the data.

```{r}
lifeGDP_wider %>% 
  rename("lifeExp_Central African Republic" = "lifeExp_CAR", "gdpPercap_Central African Republic" = "gdpPercap_CAR") %>% 
  # Give back their original names
    pivot_longer(cols      = c(-year), 
               names_to  = c(".value", "country"),
               names_sep = "_") %>% 
  arrange(country) # Arrange rows in the same order as before
  
```


## Exercise 3: Table Joins
### 3.1 Add a column for email address for each guest in the guestlist.

```{r}
email_separate <- email %>% 
                  separate_rows(guest, sep = ", ") %>% # let emails separated for each person
                  rename(name = guest) # rename for table joining
guest %>% 
   left_join(email_separate, by = c("name")) %>% # add email for each person in guest dataset 
   DT::datatable(rownames = FALSE)
```

### 3.2 Show people we have emails for yet are not on the guestlist.

```{r}
email_separate %>% 
  anti_join(guest, by = c("name")) %>% 
  DT::datatable(rownames = FALSE)
```

### 3.3 Guestlist that includes everyone we have emails for.

```{r}
guest %>% 
  full_join(email_separate, by = c("name")) %>% 
  DT::datatable(rownames = FALSE)
```

